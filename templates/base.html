<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}ColorfulMe | AI Coloring Page Studio{% endblock %}</title>
  <meta name="description" content="{% block description %}Create printable coloring pages from text and photos with ColorfulMe.{% endblock %}">
  <link rel="canonical" href="{{ request.base_url }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
  <style>
    :root {
      --brand-50: #eff6ff;
      --brand-100: #dbeafe;
      --brand-200: #bfdbfe;
      --brand-300: #93c5fd;
      --brand-500: #3b82f6;
      --brand-600: #2563eb;
      --ink-900: #0f172a;
      --ink-700: #334155;
      --ink-500: #64748b;
      --paper: #f8fbff;
    }
    body {
      font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background:
        radial-gradient(circle at 10% 0%, rgba(59,130,246,0.15), transparent 35%),
        radial-gradient(circle at 90% 100%, rgba(2,132,199,0.18), transparent 30%),
        var(--paper);
      color: var(--ink-900);
      min-height: 100vh;
    }
    h1, h2, h3, h4, h5, h6, .font-display {
      font-family: 'Space Grotesk', sans-serif;
    }
    .glass {
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148, 163, 184, 0.24);
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--brand-500), var(--brand-600));
      color: #fff;
      border: 1px solid rgba(37, 99, 235, 0.6);
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.22);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.28);
    }
    .btn-secondary {
      background: #fff;
      color: var(--ink-700);
      border: 1px solid #cbd5e1;
    }
    .btn-secondary:hover {
      background: #f8fafc;
    }
    .chip {
      border: 1px solid #bfdbfe;
      background: linear-gradient(135deg, #eff6ff, #f8fafc);
      color: #1d4ed8;
    }
    .nav-link-active {
      background: var(--brand-50);
      color: var(--brand-600);
      border-color: #bfdbfe;
    }
    .nav-shell {
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(191, 219, 254, 0.85);
      border-radius: 999px;
      padding: 0.28rem;
      box-shadow: 0 10px 24px rgba(30, 64, 175, 0.1);
    }
    .nav-pill {
      border-radius: 999px;
      padding: 0.5rem 0.85rem;
      font-weight: 600;
      color: #1e293b;
      border: 1px solid transparent;
      transition: all 160ms ease;
      white-space: nowrap;
    }
    .nav-pill:hover {
      background: #eff6ff;
      border-color: #bfdbfe;
      color: #1d4ed8;
    }
    .nav-pill-active {
      background: linear-gradient(135deg, #dbeafe, #eff6ff);
      border-color: #93c5fd;
      color: #1d4ed8;
    }
    .header-action {
      border-radius: 0.85rem;
      padding: 0.6rem 1rem;
      font-weight: 600;
      white-space: nowrap;
    }
    .mega-panel {
      border: 1px solid #cbd5e1;
      border-radius: 1.8rem;
      background: #ffffff;
      box-shadow: 0 28px 52px rgba(15, 23, 42, 0.18);
    }
    .menu-section-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.05rem;
      font-weight: 700;
      color: #0f172a;
    }
    .menu-item-link {
      display: block;
      border-radius: 0.75rem;
      padding: 0.45rem 0.55rem;
      color: #334155;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.35;
    }
    .menu-item-link:hover {
      background: #f8fbff;
      color: #1d4ed8;
    }
    .menu-accent-link {
      color: #ec4899;
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
      font-size: 1.2rem;
      line-height: 1.2;
    }
    .menu-accent-link:hover {
      color: #db2777;
    }
    .dropdown {
      position: relative;
    }
    .dropdown-panel {
      position: absolute;
      top: 100%;
      z-index: 80;
      width: min(760px, calc(100vw - 2rem));
      max-height: min(78vh, 680px);
      overflow: auto;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: translateY(8px);
      transition: opacity 160ms ease, transform 160ms ease, visibility 160ms ease;
    }
    .dropdown:hover .dropdown-panel,
    .dropdown:focus-within .dropdown-panel,
    .dropdown.open .dropdown-panel {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateY(0);
    }
    .dropdown-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.2rem;
    }
    .section-shell {
      border: 1px solid rgba(191, 219, 254, 0.85);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(248, 251, 255, 0.88));
      border-radius: 1.5rem;
      box-shadow: 0 14px 42px rgba(37, 99, 235, 0.09);
    }
    .soft-grid {
      background-image:
        linear-gradient(to right, rgba(59, 130, 246, 0.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(59, 130, 246, 0.06) 1px, transparent 1px);
      background-size: 24px 24px;
    }
    .elevate {
      transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease;
    }
    .elevate:hover {
      transform: translateY(-3px);
      border-color: var(--brand-300);
      box-shadow: 0 18px 38px rgba(30, 64, 175, 0.14);
    }
    .eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border: 1px solid rgba(191, 219, 254, 0.9);
      background: rgba(255, 255, 255, 0.92);
      color: #1d4ed8;
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      border-radius: 999px;
      padding: 0.35rem 0.65rem;
    }
    .glow-ring {
      box-shadow: 0 0 0 1px rgba(191, 219, 254, 0.8), 0 24px 50px rgba(37, 99, 235, 0.14);
    }
    .section-title {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--ink-900);
    }
    .section-copy {
      color: var(--ink-500);
    }
    .rating-stars {
      letter-spacing: 0.08em;
      color: #f59e0b;
      font-weight: 700;
    }
    [data-modal] { display: none; }
    [data-modal].open { display: flex; }
  </style>
  {% block meta_tags %}{% endblock %}
</head>
<body>
  {% set path = request.path %}
  {% set is_generator_path = path in nav_generator_paths or path.startswith('/generators') or path.startswith('/prompt-generators') %}
  {% set is_free_coloring_path = path.startswith('/free-coloring-pages') %}
  <header class="sticky top-0 z-50 border-b border-slate-200/70 glass">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between gap-4">
        <a href="/" class="inline-flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl text-white font-display font-bold bg-gradient-to-br from-blue-500 to-cyan-500">CM</span>
          <span class="font-display text-lg font-bold tracking-tight">ColorfulMe</span>
        </a>

        <nav class="hidden lg:flex items-center gap-2 text-sm nav-shell">
          <a href="/" class="nav-pill {% if path == '/' %}nav-pill-active{% endif %}">Home</a>
          <a href="/create" class="nav-pill {% if path.startswith('/create') %}nav-pill-active{% endif %}">Create</a>
          <div class="dropdown" data-dropdown>
            <a href="/free-coloring-pages" data-dropdown-trigger class="nav-pill inline-flex items-center gap-1 {% if is_free_coloring_path %}nav-pill-active{% endif %}">
              Free Coloring Pages
              <span class="text-[10px]">▾</span>
            </a>
            <div class="dropdown-panel left-0 p-7 mega-panel">
              <div class="space-y-6">
                <div>
                  <p class="menu-section-title">Browse by Age</p>
                  <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-1">
                    {% for item in nav_free_ages %}
                    <a href="{{ item.route_path }}" class="menu-item-link text-base">{{ item.title.replace('Free Coloring Pages ', '') }}</a>
                    {% endfor %}
                  </div>
                </div>
                <div class="border-t border-slate-200 pt-5">
                  <p class="menu-section-title">Popular Categories</p>
                  <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-x-5 gap-y-1">
                    {% for item in nav_free_featured[:12] %}
                    <a href="{{ item.route_path }}" class="menu-item-link text-base">{{ item.title.replace('Free ', '').replace(' Coloring Pages', '') }}</a>
                    {% endfor %}
                  </div>
                </div>
                <a href="/free-coloring-pages" class="inline-flex items-center gap-2 menu-accent-link">
                  View All {{ nav_free_categories_count }} Categories →
                </a>
              </div>
            </div>
          </div>
          <a href="/pricing" class="nav-pill {% if path.startswith('/pricing') %}nav-pill-active{% endif %}">Pricing</a>
          <div class="dropdown" data-dropdown>
            <a href="/generators" data-dropdown-trigger class="nav-pill inline-flex items-center gap-1 {% if is_generator_path %}nav-pill-active{% endif %}">
              Generators
              <span class="text-[10px]">▾</span>
            </a>
            <div class="dropdown-panel right-0 p-7 mega-panel">
              <div class="space-y-6">
                <div>
                  <p class="menu-section-title">Coloring Page Generators</p>
                  <div class="mt-3 dropdown-list">
                    {% for item in nav_generators_core[:10] %}
                    <a href="{{ item.route_path }}" class="menu-item-link text-base">{{ item.title.replace(' Coloring Page Generator', '').replace(' Generator', '') }}</a>
                    {% endfor %}
                  </div>
                  <a href="/generators" class="mt-3 inline-flex items-center gap-2 menu-accent-link">
                    View All ({{ nav_generators_core_count }} generators) →
                  </a>
                </div>
                <div class="border-t border-slate-200 pt-5">
                  <p class="menu-section-title">AI Prompt Generators</p>
                  <div class="mt-3 dropdown-list">
                    {% for item in nav_generators_prompt %}
                    <a href="{{ item.route_path }}" class="menu-item-link text-base">{{ item.title.replace(' Prompt Generator', ' Prompts') }}</a>
                    {% endfor %}
                  </div>
                  <a href="/prompt-generators" class="mt-3 inline-flex items-center gap-2 menu-accent-link">
                    View All ({{ nav_generators_prompt_count }} generators) →
                  </a>
                </div>
              </div>
            </div>
          </div>
          <a href="/blog" class="nav-pill {% if path.startswith('/blog') %}nav-pill-active{% endif %}">Blog</a>
          <a href="/library" class="nav-pill {% if path.startswith('/library') %}nav-pill-active{% endif %}">Community</a>
          {% if current_user.is_authenticated %}
          <a href="/dashboard" class="nav-pill {% if path.startswith('/dashboard') %}nav-pill-active{% endif %}">Dashboard</a>
          {% endif %}
        </nav>

        <div class="flex items-center gap-2">
          {% if current_user.is_authenticated %}
          <span class="hidden sm:inline text-xs px-3 py-1 rounded-full chip">{{ current_user.email }}</span>
          <button id="logout-btn" class="header-action btn-secondary text-sm font-medium">Logout</button>
          {% else %}
          <button id="open-auth-btn" class="header-action btn-secondary text-sm font-medium">Sign in</button>
          <a href="/create" class="header-action btn-primary text-sm font-semibold transition">Start Creating</a>
          {% endif %}
          <button id="mobile-menu-btn" class="lg:hidden px-3 py-2 rounded-lg border border-slate-300 bg-white text-slate-700">Menu</button>
        </div>
      </div>
      <div id="mobile-menu" class="lg:hidden hidden pb-4 space-y-2 text-sm">
        <a href="/" class="block px-3 py-2 rounded-lg bg-white/80">Home</a>
        <a href="/create" class="block px-3 py-2 rounded-lg bg-white/80">Create</a>
        <a href="/free-coloring-pages" class="block px-3 py-2 rounded-lg bg-white/80">Free Coloring Pages</a>
        <a href="/pricing" class="block px-3 py-2 rounded-lg bg-white/80">Pricing</a>
        <a href="/blog" class="block px-3 py-2 rounded-lg bg-white/80">Blog</a>
        <a href="/library" class="block px-3 py-2 rounded-lg bg-white/80">Community</a>
        <details class="rounded-lg bg-white/80 border border-slate-200">
          <summary class="px-3 py-2 cursor-pointer font-medium text-slate-800">Free Coloring Categories</summary>
          <div class="px-2 pb-2 space-y-1">
            <a href="/free-coloring-pages" class="block px-2 py-1.5 rounded-lg bg-blue-50 text-blue-700 font-semibold">View All Categories</a>
            <p class="px-2 pt-2 text-[11px] uppercase tracking-wide text-slate-500">Age groups</p>
            {% for item in nav_free_ages %}
            <a href="{{ item.route_path }}" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700">{{ item.title.replace('Free Coloring Pages ', '') }}</a>
            {% endfor %}
            <p class="px-2 pt-2 text-[11px] uppercase tracking-wide text-slate-500">Popular themes</p>
            {% for item in nav_free_featured[:10] %}
            <a href="{{ item.route_path }}" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700">{{ item.title.replace('Free ', '').replace(' Coloring Pages', '') }}</a>
            {% endfor %}
          </div>
        </details>
        <details class="rounded-lg bg-white/80 border border-slate-200">
          <summary class="px-3 py-2 cursor-pointer font-medium text-slate-800">Generators</summary>
          <div class="px-2 pb-2 space-y-1">
            <a href="/ai-coloring-page-generator" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700">AI Coloring Page Generator</a>
            <a href="/photo-to-coloring-page-converter" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700">Photo to Coloring Page</a>
            <a href="/photo-to-sketch" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700">Photo to Sketch</a>
            <a href="/coloring-book-generator" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700">Coloring Book Generator</a>
            <a href="/generators" class="block px-2 py-1.5 rounded-lg bg-blue-50 text-blue-700 font-semibold">View All Generators</a>
            <a href="/prompt-generators" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700">Prompt Generator Hub</a>
            <p class="px-2 pt-2 text-[11px] uppercase tracking-wide text-slate-500">Core</p>
            {% for item in nav_generators_core %}
            <a href="{{ item.route_path }}" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700 text-sm">{{ item.title.replace(' Coloring Page Generator', '').replace(' Generator', '') }}</a>
            {% endfor %}
            <p class="px-2 pt-2 text-[11px] uppercase tracking-wide text-slate-500">Prompts</p>
            {% for item in nav_generators_prompt %}
            <a href="{{ item.route_path }}" class="block px-2 py-1.5 rounded-lg hover:bg-blue-50 text-slate-700 text-sm">{{ item.title.replace(' Prompt Generator', ' Prompts') }}</a>
            {% endfor %}
          </div>
        </details>
        {% if current_user.is_authenticated %}
        <a href="/dashboard" class="block px-3 py-2 rounded-lg bg-white/80">Dashboard</a>
        {% endif %}
      </div>
    </div>
  </header>

  <main>
    {% block content %}{% endblock %}
  </main>

  <footer class="mt-20 border-t border-slate-200/70 bg-white/70">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 text-sm text-slate-600 flex flex-col md:flex-row gap-4 md:items-center md:justify-between">
      <p>© 2026 ColorfulMe. AI coloring pages for creators, families, and classrooms.</p>
      <p>US English launch • Family-safe moderation • Programmatic SEO ready</p>
    </div>
  </footer>

  <div id="auth-modal" data-modal class="fixed inset-0 z-[70] items-center justify-center p-4 bg-slate-900/50">
    <div class="w-full max-w-md bg-white rounded-2xl border border-slate-200 shadow-2xl p-6">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="font-display text-2xl font-bold text-slate-900">Sign in to ColorfulMe</h2>
          <p class="mt-1 text-sm text-slate-600">Use Google or email code login.</p>
        </div>
        <button id="close-auth-btn" class="px-2 py-1 rounded border border-slate-300 text-slate-600">✕</button>
      </div>

      <div class="mt-5 space-y-4">
        <a href="/auth/google/start?next={{ request.path }}" class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg border border-slate-300 bg-white hover:bg-slate-50 text-sm font-medium">
          Continue with Google
        </a>

        <div class="relative">
          <hr class="border-slate-200">
          <span class="absolute -top-2 left-1/2 -translate-x-1/2 text-xs px-2 bg-white text-slate-400">or</span>
        </div>

        <div class="space-y-3">
          <input id="auth-email" type="email" placeholder="you@example.com" class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-300">
          <div class="grid grid-cols-2 gap-2">
            <button id="send-code-btn" class="px-3 py-2 rounded-lg btn-secondary text-sm font-medium">Send Code</button>
            <input id="auth-code" type="text" placeholder="6-digit code" class="px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-300">
          </div>
          <button id="verify-code-btn" class="w-full px-4 py-2 rounded-lg btn-primary text-sm font-semibold">Verify & Sign In</button>
          <p id="auth-status" class="text-xs text-slate-500 min-h-[1.2rem]"></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
    }

    const desktopDropdowns = Array.from(document.querySelectorAll('[data-dropdown]'));
    const closeDesktopDropdowns = () => desktopDropdowns.forEach((node) => node.classList.remove('open'));
    desktopDropdowns.forEach((dropdown) => {
      const trigger = dropdown.querySelector('[data-dropdown-trigger]');
      if (!trigger) return;
      trigger.addEventListener('click', (event) => {
        event.preventDefault();
        const wasOpen = dropdown.classList.contains('open');
        closeDesktopDropdowns();
        if (!wasOpen) {
          dropdown.classList.add('open');
        }
      });
      trigger.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          dropdown.classList.remove('open');
        }
      });
    });
    document.addEventListener('click', (event) => {
      if (!desktopDropdowns.some((dropdown) => dropdown.contains(event.target))) {
        closeDesktopDropdowns();
      }
    });
    window.addEventListener('scroll', closeDesktopDropdowns, { passive: true });

    const authModal = document.getElementById('auth-modal');
    const openAuthBtn = document.getElementById('open-auth-btn');
    const closeAuthBtn = document.getElementById('close-auth-btn');
    const statusEl = document.getElementById('auth-status');

    if (openAuthBtn && authModal) {
      openAuthBtn.addEventListener('click', () => authModal.classList.add('open'));
    }
    if (closeAuthBtn && authModal) {
      closeAuthBtn.addEventListener('click', () => authModal.classList.remove('open'));
    }
    if (authModal) {
      authModal.addEventListener('click', (event) => {
        if (event.target === authModal) authModal.classList.remove('open');
      });
    }

    async function postJSON(url, payload) {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      return { ok: res.ok, data: await res.json() };
    }

    const sendCodeBtn = document.getElementById('send-code-btn');
    if (sendCodeBtn) {
      sendCodeBtn.addEventListener('click', async () => {
        const email = document.getElementById('auth-email').value;
        statusEl.textContent = 'Sending code...';
        try {
          const { ok, data } = await postJSON('/auth/email/send-code', { email });
          if (!ok) throw new Error(data.error || 'Failed to send code');
          statusEl.textContent = data.code ? `Code sent. Dev code: ${data.code}` : 'Code sent. Check your inbox.';
        } catch (err) {
          statusEl.textContent = err.message;
        }
      });
    }

    const verifyCodeBtn = document.getElementById('verify-code-btn');
    if (verifyCodeBtn) {
      verifyCodeBtn.addEventListener('click', async () => {
        const email = document.getElementById('auth-email').value;
        const code = document.getElementById('auth-code').value;
        statusEl.textContent = 'Verifying...';
        try {
          const { ok, data } = await postJSON('/auth/email/verify-code', { email, code });
          if (!ok) throw new Error(data.error || 'Verification failed');
          statusEl.textContent = 'Signed in. Reloading...';
          window.location.reload();
        } catch (err) {
          statusEl.textContent = err.message;
        }
      });
    }

    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', async () => {
        await fetch('/auth/logout', { method: 'POST' });
        window.location.href = '/';
      });
    }
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
